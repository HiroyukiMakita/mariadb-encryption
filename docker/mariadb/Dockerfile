ARG DATABASE_IMAGE_VERSION
FROM mariadb:${DATABASE_IMAGE_VERSION}

ARG HOST_DATABASE_CONF_DIR
ARG CONTAINER_DATABASE_CONF_DIR
ARG DATABASE_CONF_FILE
ARG HOST_ENCRYPTION_KEY_FILE
ARG CONTAINER_ENCRYPTION_KEY_FILE
ARG HOST_ENCRYPTION_KEY_FILE_KEY
ARG CONTAINER_ENCRYPTION_KEY_FILE_KEY

RUN apt-get update \
  && apt-get install -y sudo vim less binutils bsdmainutils \
  # Clear cache
  && apt-get clean && rm -rf /var/lib/apt/lists/*

ADD ${HOST_DATABASE_CONF_DIR}/${DATABASE_CONF_FILE} ${CONTAINER_DATABASE_CONF_DIR}/${DATABASE_CONF_FILE}
ADD ${HOST_ENCRYPTION_KEY_FILE} ${CONTAINER_ENCRYPTION_KEY_FILE}
ADD ${HOST_ENCRYPTION_KEY_FILE_KEY} ${CONTAINER_ENCRYPTION_KEY_FILE_KEY}

RUN chmod 644 ${CONTAINER_DATABASE_CONF_DIR}/${DATABASE_CONF_FILE} \
  && chown mysql:mysql ${CONTAINER_ENCRYPTION_KEY_FILE_KEY} \
  && chmod 400 ${CONTAINER_ENCRYPTION_KEY_FILE_KEY}
